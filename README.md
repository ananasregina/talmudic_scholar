# ×ª×œ××•×“ ×—×›× (Talmudic Scholar)

AI-Powered Talmudic Research Assistant - POC with RAG and Vector Search

## ğŸ“š Overview

Talmudic Scholar is a proof-of-concept application that combines modern AI technologies with ancient Jewish texts. It enables users to ask questions about Torah, Mishnah, Talmud, and rabbinic literature, receiving responses grounded in primary sources through Retrieval-Augmented Generation (RAG).

### Features

- **Vector-based semantic search** using PostgreSQL + pgvector
- **Embeddings generated by LM Studio** (local, privacy-preserving)
- **RAG pipeline** using Z.AI's GLM 4.7 model for contextual responses
- **TUI interface** for interactive study sessions
- **Source-cited answers** with specific references to Talmudic texts

---

## ğŸ”§ Prerequisites

### Required Software

1. **Node.js** (Version 18-22 recommended; Node.js 25 has known compatibility issues)
   - [Download Node.js](https://nodejs.org/)
   - Verify: `node --version`

2. **PostgreSQL** (Version 15+)
   - [Download PostgreSQL](https://www.postgresql.org/download/)
   - Verify: `psql --version`

3. **pgvector Extension** for PostgreSQL
   ```bash
   # On macOS with Homebrew
   brew install pgvector

   # On Ubuntu/Debian
   sudo apt-get install postgresql-15-pgvector
   ```

4. **LM Studio** (Local LLM Server)
   - Download from [lmstudio.ai](https://lmstudio.ai/)
   - Install and start LM Studio
   - Download the `nomic-embed-text-v1.5` embedding model
   - Start the local API server on port 1338

### Verify Prerequisites

Before proceeding, verify all prerequisites are running:

```bash
# Check PostgreSQL
psql --version

# Check pgvector (run in psql)
psql -U postgres -c "SELECT name FROM pg_available_extensions WHERE name='vector';"

# Check LM Studio
curl http://127.0.0.1:1338/v1/models
```

---

## ğŸš€ Installation

### 1. Clone the Repository

```bash
cd /Users/talimoreno/Documents/talmudic_scholar
```

### 2. Install Dependencies

```bash
npm install
```

### 3. Configure Environment Variables

Copy the example environment file and configure it:

```bash
cp .env.example .env
```

Edit `.env` and set your configuration:

```env
# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=talmudic_scholar
DB_USER=postgres
DB_PASSWORD=your_postgres_password

# Embeddings (LM Studio)
EMBEDDING_URL=http://127.0.0.1:1338/v1
EMBEDDING_MODEL=text-embedding-nomic-embed-text-v1.5-embedding
EMBEDDING_DIMENSION=768
EMBEDDING_CHUNK_SIZE_BYTES=1024

# Z.AI LLM API
ZAI_API_KEY=your_zai_api_key_here
ZAI_API_URL=https://open.bigmodel.cn/api/paas/v4/
ZAI_MODEL=glm-4-plus
```

**Important:**
- Set a valid PostgreSQL password in `DB_PASSWORD`
- Ensure LM Studio is running on port 1338 with the embedding model loaded
- Obtain a Z.AI API key from [bigmodel.cn](https://open.bigmodel.cn/)

---

## ğŸ“– Setup Guide

### Step 1: Initialize Database

Create the PostgreSQL database with pgvector extension:

```bash
npm run db:init
```

**Expected Output:**
```
Database initialized successfully
```

**Troubleshooting:**
- If you get connection errors, ensure PostgreSQL is running
- If pgvector is not found, install the extension per the Prerequisites section

### Step 2: Download Talmudic Texts

Download sample texts from Sefaria:

```bash
npm run download
```

**Expected Output:**
```
Starting Sefaria download...
Target directory: /Users/talimoreno/Documents/talmudic_scholar/data/raw

Downloading Genesis.json...
Saved Genesis.json to /Users/talimoreno/Documents/talmudic_scholar/data/raw
Downloading Berakhot.json...
Saved Berakhot.json to /Users/talimoreno/Documents/talmudic_scholar/data/raw
Downloading Mishnah_Berakhot.json...
Saved Mishnah_Berakhot.json to /Users/talimoreno/Documents/talmudic_scholar/data/raw

Download complete. Files saved to /Users/talimoreno/Documents/talmudic_scholar/data/raw
```

### Step 3: Ingest Documents

Process the downloaded texts and generate embeddings:

```bash
npm run ingest
```

**Expected Output:**
```
============================================================
Talmudic Scholar - Data Ingestion Pipeline
============================================================
Embedding URL: http://127.0.0.1:1338/v1
Embedding Model: text-embedding-nomic-embed-text-v1.5-embedding
Embedding Dimension: 768
============================================================
Found 3 JSON files to process

Processing Genesis.json as Torah...
  Ingested 10/50 chunks from Genesis.json...
  Complete: Ingested 50 chunks from Genesis.json

Processing Berakhot.json as Talmud...
  Ingested 10/200 chunks from Berakhot.json...
  Complete: Ingested 200 chunks from Berakhot.json

Processing Mishnah_Berakhot.json as Mishnah...
  Ingested 10/80 chunks from Mishnah_Berakhot.json...
  Complete: Ingested 80 chunks from Mishnah_Berakhot.json

âœ“ Total ingested: 330 chunks from 3 files

âœ“ Ingestion completed in 45.23s
============================================================
```

**Troubleshooting:**
- If you get embedding errors, ensure LM Studio is running
- If you get database connection errors, ensure PostgreSQL is initialized
- If you see dimension mismatch errors, verify `EMBEDDING_DIMENSION` matches your model

### Step 4: Launch the TUI Interface

Start the interactive terminal user interface:

```bash
npm run dev
```

You should see the Talmudic Scholar interface:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ×ª×œ××•×“ ×—×›× (Talmudic Scholar)                             â•‘
â•‘  Ask questions about Torah, Talmud, and rabbinic literature â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ’¡ Usage Guide

### Interactive Q&A

Once the TUI is running, type your questions in the input field at the bottom:

```
> What does Berakhot 2a discuss?
```

Press Enter to submit. The system will:
1. Search for relevant passages in the database
2. Generate a response using the GLM 4.7 model
3. Display the answer with source citations

### Example Questions

Here are some sample questions to try:

**Torah Questions:**
- "What is the story of the Binding of Isaac in Genesis 22?"
- "Explain the Ten Commandments from Exodus 20"
- "What does Genesis 1 teach about creation?"

**Mishnah Questions:**
- "What does Mishnah Berakhot say about the Shema?"
- "How should one recite the Amidah according to the Mishnah?"
- "What blessings are mentioned in Berakhot?"

**Talmud Questions:**
- "What is the Gemara's discussion on Berakhot 2a about?"
- "Why do we recite the Shema twice daily according to the Talmud?"
- "What is the debate about the time of the Shema in Berakhot?"

**Comparative Questions:**
- "Compare the Torah's account of creation with Talmudic interpretations"
- "How does the Mishnah differ from the Talmud in discussing blessings?"
- "What are the different opinions on the order of blessings?"

### Keyboard Shortcuts

- **Ctrl+C**: Exit the application (graceful shutdown)
- **Tab**: Navigate between UI elements (if available)
- **Enter**: Submit your question

---

## ğŸ—ï¸ Architecture

### Tech Stack

- **Backend**: Node.js + TypeScript
- **Database**: PostgreSQL 15+ with pgvector extension
- **Vector Search**: pgvector (IVFFlat index for cosine similarity)
- **Embeddings**: LM Studio (Nomic Embed Text v1.5)
- **LLM**: Z.AI GLM 4.7
- **UI**: OpenTUI (Terminal User Interface)

### Data Flow

```
User Question
    â†“
Generate Query Embedding (LM Studio)
    â†“
Vector Similarity Search (PostgreSQL pgvector)
    â†“
Retrieve Top-k Relevant Documents
    â†“
Construct Context from Documents
    â†“
Generate Response (GLM 4.7)
    â†“
Display Answer with Source Citations
```

### Project Structure

```
talmudic_scholar/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config.ts           # Configuration management
â”‚   â”œâ”€â”€ index.ts            # Main entry point with CLI
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ init.ts         # Database initialization
â”‚   â”‚   â””â”€â”€ schema.ts       # SQL schema definitions
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ embeddings.ts   # Embedding generation
â”‚   â”‚   â””â”€â”€ rag.ts          # RAG pipeline & search
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ download.ts     # Sefaria data downloader
â”‚   â”‚   â””â”€â”€ ingest.ts       # Document ingestion pipeline
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ app.tsx         # TUI interface
â”œâ”€â”€ data/
â”‚   â””â”€â”€ raw/                # Downloaded JSON files
â”œâ”€â”€ .env                    # Environment variables (not in git)
â”œâ”€â”€ .env.example            # Environment template
â”œâ”€â”€ package.json            # Dependencies & scripts
â””â”€â”€ tsconfig.json           # TypeScript configuration
```

---

## ğŸ”’ Important Notes

### Known Issues

1. **Node.js 25 Compatibility**: The TUI has runtime compatibility issues with Node.js 25 due to `.scm` file loading errors. **Recommendation**: Use Node.js 18-22 for the demo.

2. **Performance**: This is a POC - not optimized for production use. Performance may vary based on hardware and data size.

3. **Data Quality**: Sample texts from Sefaria may contain HTML artifacts or formatting issues. The ingestion pipeline includes basic cleanup.

### Limitations

- **No Internet Required**: Once data is ingested, the system works offline (except for Z.AI API calls)
- **Single Language**: Primarily supports English with some Hebrew content
- **Limited Corpus**: Currently includes only Genesis, Berakhot (Talmud), and Mishnah Berakhot for demo purposes
- **No Psak Halacha**: This is an educational tool, not a source for halachic decisions

### Best Practices

- Use meaningful, specific questions for better results
- Reference specific texts (e.g., "Berakhot 2a") when possible
- Check the source citations to verify information
- For practical halachic matters, always consult a qualified Orthodox rabbi

---

## ğŸ› Troubleshooting

### Database Issues

**Error**: `connection refused` or `could not connect to server`
- **Solution**: Ensure PostgreSQL is running
  ```bash
  # macOS
  brew services start postgresql

  # Ubuntu
  sudo systemctl start postgresql
  ```

**Error**: `extension "vector" does not exist`
- **Solution**: Install pgvector extension
  ```bash
  # macOS with Homebrew
  brew install pgvector

  # Ubuntu
  sudo apt-get install postgresql-15-pgvector
  ```

### Embedding Issues

**Error**: `ECONNREFUSED` when connecting to LM Studio
- **Solution**: Ensure LM Studio is running with the embedding model
  1. Open LM Studio
  2. Download `nomic-embed-text-v1.5`
  3. Go to the "Local Server" tab
  4. Click "Start Server"
  5. Ensure it's running on port 1338

**Error**: `Embedding dimension mismatch`
- **Solution**: Verify `EMBEDDING_DIMENSION` in `.env` matches your model's output dimension
  - Nomic Embed Text v1.5 produces 768-dimensional vectors
  - Check LM Studio for your specific model's dimension

### LLM Issues

**Error**: `Unauthorized` or `Invalid API key`
- **Solution**: Verify `ZAI_API_KEY` in `.env` is correct
  - Get a key from [bigmodel.cn](https://open.bigmodel.cn/)

**Error**: `Connection timeout` or `Network error`
- **Solution**: Check your internet connection (Z.AI API requires internet)

### TUI Issues

**Error**: `.scm file loading error` (Node.js 25 only)
- **Solution**: Downgrade to Node.js 18-22
  ```bash
  # Using nvm
  nvm install 20
  nvm use 20
  ```

**Error**: `React is not defined`
- **Solution**: Ensure all dependencies are installed
  ```bash
  npm install
  ```

---

## ğŸ“ Development

### Available Scripts

- `npm run db:init` - Initialize PostgreSQL database
- `npm run download` - Download texts from Sefaria
- `npm run ingest` - Ingest documents with embeddings
- `npm run dev` - Launch TUI interface
- `npm run build` - Build TypeScript to JavaScript
- `npm run start` - Run built application

### Adding New Texts

To add new Talmudic texts:

1. Find the text on [Sefaria](https://www.sefaria.org/)
2. Add the URL to `DOWNLOAD_TARGETS` in `src/scripts/download.ts`
3. Run `npm run download` to fetch the text
4. Run `npm run ingest` to process and index it

### Customizing the LLM

To change the LLM model:

1. Update `ZAI_MODEL` in `.env`
2. Verify the model is available in Z.AI's API
3. Adjust `max_tokens` and `temperature` in `src/services/rag.ts` if needed

---

## ğŸ“„ License

MIT License - See LICENSE file for details

---

## ğŸ™ Acknowledgments

- **Sefaria**: For providing open access to Jewish texts
- **pgvector**: For efficient vector similarity search
- **LM Studio**: For local embedding generation
- **Z.AI**: For providing the GLM 4.7 model
- The broader open-source community for the tools that make this possible

---

## ğŸ“ Support

For questions or issues:
1. Check the Troubleshooting section
2. Review error messages carefully
3. Verify all prerequisites are met
4. Ensure configuration values in `.env` are correct

---

**Demo Ready**: This POC is prepared for demonstration. Follow the Setup Guide and you'll be exploring Talmudic texts in minutes! ğŸ‰
